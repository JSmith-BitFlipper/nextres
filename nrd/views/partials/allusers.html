{{#if error}}
  <div class="error-msg">{{error}}</div>
{{/if}}
<h1>All Residents</h1>
<p>Adding a new user will create an account and send them an email. When inputting Kerberos, do not include @mit.edu.</p>
<h2>Adding Users</h2>
<p>One kerberos per line</p>
<form method="post" action="allusers">
<textarea name="massadd"></textarea>
<input type="submit" value="Create">
</form>
</p>
<!--
<p>
	<form method="post" action="signup">
		<p>Add Single User: <input type="text" name="kerberos"></p>
		<input type="submit">
	</form>
</p>
-->
<h2>All Users</h2>
<p>Below is a list of all the users</p>
<p>
  <table class="displaytable">
    <tr>
      <th>Kerberos</th>
      <th width="240">Resident Name</th>
      <th>Room</th>
      <th>Role</th>
      <th>Reset Password</th>
      <th>Remove</th>
    </tr>
    {{#each result}}
	<tr id="{{this.kerberos}}-tr">
	  <td>{{this.kerberos}}</td>
	  <td>{{this.firstName}} {{this.lastName}}</td>
	  <td>{{this.roomNumber}}</td>
	  <td>
	    {{#if this.possibleRoles}}
	  	<select>
	  	  {{#each this.possibleRoles}}
	  	  <option>{{this.name}}</option>
	  	  {{/each}}
	  	</select>
	  	{{else}}
	  	  {{this.name}}
	  	{{/if}}
	  </td>
          <td><a id="{{this.kerberos}}-pwreset" class="pwreset">reset pass</a></td>
	  <td><a id="{{this.kerberos}}-remove" class="remove">X</a></td>
	</tr>
  	{{/each}}
  </table>
</p>

<script type="text/javascript">
  $('.remove').on('click', function(e) {
    var yes = $('<a>').html('yes').on('click',
      function(e2) {
        kerberos = e.target.id;
        kerberos = kerberos.substring(0,kerberos.length-'-remove'.length);
        $.ajax('/remove',{data:{kerberos:kerberos}, type:"POST"});
        $('#'+kerberos+'-tr').remove();
      }
    );
    var no = $('<a>').html('no').on('click',
      function(e2) { $(e.target).html('X'); }
    );
    $(e.target).html(yes).append('&nbsp;&nbsp;').append(no);
  });
</script>

<script type="text/javascript">
  $('.pwreset').on('click', function(e) {
    var yes = $('<a>').html('yes').on('click',
      function(e2) {
        kerberos = e.target.id;
        kerberos = kerberos.substring(0,kerberos.length-'-pwreset'.length);
        $.ajax('/pwreset',{data:{kerberos:kerberos}, type:"POST"});
        $(e.target).html('password reset');
      }
    );
    var no = $('<a>').html('no').on('click',
      function(e2) { $(e.target).html('reset pass'); }
    );
    $(e.target).html(yes).append('&nbsp;&nbsp;').append(no);
  });
</script>

{{results}}
