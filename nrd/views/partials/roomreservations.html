{{#if userReservations}}
  <section class="content-header">
      <h1>
          Your Room Reservations
          <small>Below are the rooms you have reserved. Click on a reservation to edit.</small>
        </h1>
  </section>
	<ul>
	{{#each userReservations}}
	<li class="reservation" id="remove-reservation-li-{{this.id}}">
                <span><a href="/roomreservations/{{this.id}}" class="edit_reservation">{{this.summary}} at {{this.formattedTime}}</a></span>
		<span><a id="remove-reservation-{{this.id}}" class="remove_reservation remove">cancel reservation</a></span>
	</li>
	{{/each}}
	</ul>
{{/if}}


<section class="content">
<h3>Reserve a Room</h3>

<p>All room reservations follow House policies <a href="http://nextres.mit.edu/documents/NextHouseUpdatedReservationPolicies.pdf">here</a> as well as in the updated community handbook.</p>
<p><em>Please review these policies if you are unsure of how to reserve a room.</em></p>

<p><b>Note:</b> only three outstanding reservations are allowed at a time. For more reservations, please contact next-exec@mit.edu.</p>


<form method="post">

    <fieldset>
    	<label for="room">Room</label>
    	<select class="sel_room form-group" name="room">
        	<option class="form-control" value="">--</option>
        	<option class="form-control" value="Country Kitchen">Country Kitchen</option>
        	<option class="form-control" value="Conference Room">Conference Room</option>
        	<option class="form-control" value="TFL">TFL</option>
        	<option class="form-control" value="PDR">Private Dining Room (PDR)</option>
        	<option class="form-control" value="Courtyard">Courtyard & BBQ Pits</option>
        	<option class="form-control" value="TFL TV area">TFL TV Area</option>
        	<option class="form-control" value="Music Room">Music Room</option>
    	</select>
    </fieldset>
    <fieldset>
    	<label for="people">Number of People</label>
    	<select class="sel_people form-group" name="people">
        	<option class="form-control" value="">--</option>
        	<option class="form-control" value="0">&lt;10</option>
        	<option class="form-control" value="1">&ge;10</option>
    	</select>
    </fieldset>
    <!-- reservation part 2 -->
    <div class="part2" style="display: none;">
    <h3>Signatories</h3>
    <p><span class='nres'></span> Next House Residents are required to reserve the <span class='nroom'></span>. Please enter their <em>kerberoses</em>.</p>
    <table class="room-reserve">
    	<tr>
    		<td><label for="signatory1">Resident 1 </label> </td>
    		<td><input type="text" placeholder="kerberos" value="{{user.kerberos}}" name="signatory1" disabled="disabled"></td>
    	</tr>
    	<tr>
    		<td><label for="signatory2">Resident 2 </label> </td>
    		<td><input type="text" placeholder="kerberos" name="signatory2" required></td>
    	</tr>
    	<tr class="r3" style="display: hidden;">
    		<td><label for="signatory3">Resident 3 </label> </td>
    		<td><input type="text" placeholder="kerberos" name="signatory3"></td>
    	</tr>
    </table>
    
    <h3>Reservation Details</h3>
    <p>To reserve multiple days, please fill out multiple reservations.</p>
  <p>
    <table class="room-reserve">
    	<tr>
    		<td><label for="date">Date </label> </td>
    		<td>
  				<span class="nodate"></span>
  				<input type="date" name="date" required>
  			</td>
    	</tr>
    	<tr>
    		<td>
    			<label for="date">Time </label> </td>
    		<td>
    			<input id="startTime" name="start" type="text" class="time ui-timepicker-input" autocomplete="off" required> to 
    			<input id="endTime" name="end" type="text" class="time ui-timepicker-input" autocomplete="off" required>
    		</td>
    	</tr>
    </table>
  </p>
    <p>
    	<br />
        <textarea class="form-control" name="reason" rows="5" cols="60" placeholder="Description of Event/Activity">
          {{#if prevParams}}{{prevParams.reason}}{{/if}}
        </textarea>
    </p>
    <div class="row">
      <div class="col-lg-4 col-xs-12">
        <button type="submit" class="btn btn-success col-lg-4 col-xs-12" value="Submit Room Reservation Request">Submit Room Reservation Request</button>
      </div>
    </div>
</form>

</div> <!-- closetag for part2. not ideal, I know -->

<br>

<iframe class="calendarIframe" src="https://www.google.com/calendar/embed?showTitle=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;height=400&amp;wkst=1&amp;bgcolor=%23ffffff&amp;src=87a94e6q5l0nb6bfphe3192uv8%40group.calendar.google.com&amp;color=%232952A3&amp;ctz=America%2FNew_York" style=" border-width:0 " width="100%" height="400" frameborder="0" scrolling="no"></iframe>

</section>

<script type="text/javascript">

  $('.remove_reservation').on('click', function(e) {
    var yes = $('<a class="remove">').html('are you sure?').on('click',
      function(e2) {
        event_id = e.target.id.substring('remove-reservation-'.length);
        $.ajax('/roomreservations',{data:{id:event_id}, type:"DELETE"});
        $('#remove-reservation-li-'+event_id).remove();
      }
    );
    $(e.target).parent().html(yes);
  });
  
  $('select').on('change', function(){
  	$('.part2').hide();
  	var UNSELECTED = "";
  	
  	room = $('.sel_room').val();
  	if ($('.sel_people').val() == 1) {
  		$('.r3').show();
  		$('.nres').text(3);
  		$('.nroom').text(room);
  	} else {
  		$('.r3').hide();
  		$('.nres').text(2);
  		$('.nroom').text(room);

  	}
  	
  	if ($('.sel_room').val() != UNSELECTED && $('.sel_people').val() != UNSELECTED){
  		$('.part2').slideDown(600);
  		window.setTimeout(function(){$.scrollTo('.part2', 600, {easing:'swing', offset: {top: -15, left: 0}})}, 400);
  	}
  	
  });


$(document).ready(function(){
	if (!Modernizr.inputtypes.date) {
		$('.nodate').text('Format YYYY-MM-DD');
	}

  $('#startTime').timepicker({ 
	'maxTime': '23:59',
  	'forceRoundTime': true 
  });
  $('#startTime').on('changeTime', function() {
	stime = $(this).val();
	$('#endTime').timepicker('option', {'minTime': stime});
  });
  $('#endTime').timepicker({
	'minTime': '2:00pm',
	'maxTime': '12:00am',
	'showDuration': true,
	'forceRoundTime': true 
  });
  $('.deny-reservation').on('click', function(e) {
      event_id = e.target.id.substring('deny-reservation-'.length);
      reason = $('#deny-reservation-reason-' + event_id).val();
      $.ajax('/roomreservationdeny', {data: {id: event_id, reason: reason}, type: "POST"});
      $('#deny-reservation-li-' + event_id).remove();
  });

  {{#if prevParams}}
  // Prefill form with previous params, if applicable.
  $('.sel_room').find('option[value="{{prevParams.room}}"]').attr('selected', true);
  $('.sel_people').find('option[value="{{prevParams.people}}"]').attr('selected', true);
  room = $('.sel_room').val();
  if ($('.sel_people').val() == 1) {
    $('.r3').show();
    $('.nres').text(3);
    $('.nroom').text(room);
  } else {
    $('.r3').hide();
    $('.nres').text(2);
    $('.nroom').text(room);
  }
  $('.part2').show();
  $('[name="signatory2"]').attr('value', '{{prevParams.signatory2}}');
  $('[name="signatory3"]').attr('value', '{{prevParams.signatory3}}');
  $('[name="date"]').attr('value', '{{prevParams.date}}');
  $('[name="start"]').attr('value', '{{prevParams.start}}');
  $('[name="end"]').attr('value', '{{prevParams.end}}');
  {{/if}}
});
  
</script>
